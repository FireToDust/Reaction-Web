<!DOCTYPE html> <html lang="en"><head>
<title>gpu-shaders</title>
<base href="../../..">
<meta name="pathname" content="architecture/systems/physics/gpu-shaders.html">
<meta name="description" content="source_docs - gpu-shaders">
<meta property="og:title" content="gpu-shaders">
<meta property="og:description" content="source_docs - gpu-shaders">
<meta property="og:type" content="website">
<meta property="og:url" content="architecture/systems/physics/gpu-shaders.html">
<meta property="og:image" content="undefined">
<meta charset="UTF-8"><meta property="og:site_name" content="source_docs"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-wasm-script" src="site-lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="site-lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="preload" href="site-lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/snippets.css"></noscript><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager show-inline-title show-ribbon is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">status</span><span class="token punctuation">:</span> proposed
<span class="token key atrule">tags</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> Implementation
<span class="token key atrule">todo</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"[implementation] Implement overlap pass scatter-gather algorithm for combinations"</span>
  <span class="token punctuation">-</span> <span class="token string">"[implementation] Optimize workgroup shared memory for hex neighborhoods"</span>
  <span class="token punctuation">-</span> <span class="token string">"[implementation] Determine optimal workgroup size through profiling"</span></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="gpu-shaders_0">gpu-shaders</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h1"><h1 data-heading="GPU Shader Architecture" dir="auto" class="heading" id="GPU_Shader_Architecture_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>GPU Shader Architecture</h1></div><div class="el-p"><p dir="auto">Multi-pass GPU compute pipeline for force-based physics with combination mechanics on a hexagonal grid.</p></div><div class="el-h2"><h2 data-heading="Pipeline Overview" dir="auto" class="heading" id="Pipeline_Overview_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Pipeline Overview</h2></div><div class="el-p"><p dir="auto">The physics system uses a sequence of GPU compute passes to update object positions and handle combinations:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><strong>Apply Forces + Move</strong>: Calculate and apply all forces, update velocities and sub-grid offsets</li>
<li data-line="1" dir="auto"><strong>Overlap Passes (2-N)</strong>: Detect and merge objects that are too close</li>
<li data-line="2" dir="auto"><strong>Set Grid Position</strong>: Update hex cell assignments based on final offsets</li>
</ol></div><div class="el-h2"><h2 data-heading="Pass 1: Apply Forces + Move" dir="auto" class="heading" id="Pass_1_Apply_Forces_+_Move_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Pass 1: Apply Forces + Move</h2></div><div class="el-h3"><h3 data-heading="Overview" dir="auto" class="heading" id="Overview_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Overview</h3></div><div class="el-p"><p dir="auto"><strong>Purpose</strong>: Apply collision, cohesion, and spell forces; update velocity and sub-grid offset.</p></div><div class="el-p"><p dir="auto"><strong>Grid Position Preserved</strong>: Objects remain in their current hex cell until final pass.</p></div><div class="el-p"><p dir="auto"><strong>Neighbor Range</strong>: Check two-layer hexagonal neighborhood for force interactions.</p></div><div class="el-h3"><h3 data-heading="Shader Structure" dir="auto" class="heading" id="Shader_Structure_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Shader Structure</h3></div><div class="el-pre"><pre class="language-wgsl"><code data-line="0" class="language-wgsl is-loaded"><span class="token punctuation">@</span><span class="token attributes attr-name">compute</span> <span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">8</span><span class="token punctuation">,</span> <span class="token int-literal number">8</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">apply_forces_and_move</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span> global_id<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">local_invocation_id</span><span class="token punctuation">)</span></span> local_id<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hex_coord <span class="token operator">=</span> <span class="token function-calls function">calculate_hex_coord</span><span class="token punctuation">(</span>global_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token function-calls function">read_object</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>object<span class="token punctuation">.</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Load two-layer hex neighborhood into shared memory</span>
    <span class="token function-calls function">load_hex_neighborhood_to_cache</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">,</span> local_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">workgroupBarrier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Accumulate forces from neighbors</span>
    <span class="token keyword">var</span> total_force <span class="token operator">=</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">,</span> <span class="token int-literal number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fixed-point</span>

    <span class="token comment">// Collision forces (from overlapping objects)</span>
    total_force <span class="token operator">+=</span> <span class="token function-calls function">calculate_collision_forces</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> neighborhood_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Cohesion forces (from nearby objects within radius)</span>
    total_force <span class="token operator">+=</span> <span class="token function-calls function">calculate_cohesion_forces</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> neighborhood_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Spell forces (from overlapping spell shapes)</span>
    total_force <span class="token operator">+=</span> <span class="token function-calls function">calculate_spell_forces</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> spell_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Update velocity (F = ma, so a = F/m)</span>
    <span class="token keyword">let</span> acceleration <span class="token operator">=</span> <span class="token function-calls function">fixed_point_divide</span><span class="token punctuation">(</span>total_force<span class="token punctuation">,</span> object<span class="token punctuation">.</span>mass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    object<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token function-calls function">fixed_point_add</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>velocity<span class="token punctuation">,</span> acceleration<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Clamp velocity to maximum</span>
    object<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token function-calls function">clamp_velocity</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>velocity<span class="token punctuation">,</span> MAX_VELOCITY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Update sub-grid offset (don't change hex cell assignment yet)</span>
    object<span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token function-calls function">fixed_point_add</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>offset<span class="token punctuation">,</span> object<span class="token punctuation">.</span>velocity<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function-calls function">write_object</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="Force Calculations" dir="auto" class="heading" id="Force_Calculations_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Force Calculations</h3></div><div class="el-p"><p dir="auto"><strong>Collision Forces</strong>: For each overlapping neighbor, calculate repulsion force based on overlap distance and mass.</p></div><div class="el-p"><p dir="auto"><strong>Cohesion Forces</strong>: For neighbors within cohesion radius, calculate attraction force toward group centroid.</p></div><div class="el-p"><p dir="auto"><strong>Spell Forces</strong>: Check spell buffer for overlapping spell shapes; apply impulses or set velocities based on element type.</p></div><div class="el-p"><p dir="auto"><strong>Details</strong>: See <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/physics/forces.html" data-href="forces" aria-label="forces" data-tooltip-position="top" target="_self">Forces</a></span></span></span> for force formulas and mechanics.</p></div><div class="el-h2"><h2 data-heading="Pass 2-N: Overlap Passes" dir="auto" class="heading" id="Pass_2-N_Overlap_Passes_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Pass 2-N: Overlap Passes</h2></div><div class="el-h3"><h3 data-heading="Overview" dir="auto" class="heading" id="Overview_1"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Overview</h3></div><div class="el-p"><p dir="auto"><strong>Purpose</strong>: Detect objects closer than combination distance d; merge them into single objects.</p></div><div class="el-p"><p dir="auto"><strong>Scatter-Gather</strong>: Complex algorithm to identify and merge groups of nearby objects.</p></div><div class="el-p"><p dir="auto"><strong>Multiple Passes</strong>: May require several passes to fully resolve cascading combinations.</p></div><div class="el-p"><p dir="auto"><strong>⚠️ NEEDS SPECIFICATION</strong>: Exact scatter-gather implementation approach TBD.</p></div><div class="el-h3"><h3 data-heading="Shader Structure" dir="auto" class="heading" id="Shader_Structure_1"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Shader Structure</h3></div><div class="el-pre"><pre class="language-wgsl"><code data-line="0" class="language-wgsl is-loaded"><span class="token punctuation">@</span><span class="token attributes attr-name">compute</span> <span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">8</span><span class="token punctuation">,</span> <span class="token int-literal number">8</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">overlap_detection_pass</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span> global_id<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">local_invocation_id</span><span class="token punctuation">)</span></span> local_id<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hex_coord <span class="token operator">=</span> <span class="token function-calls function">calculate_hex_coord</span><span class="token punctuation">(</span>global_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token function-calls function">read_object</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>object<span class="token punctuation">.</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Load two-layer hex neighborhood</span>
    <span class="token function-calls function">load_hex_neighborhood_to_cache</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">,</span> local_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">workgroupBarrier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Find all objects within combination distance d</span>
    <span class="token keyword">var</span> nearby_objects <span class="token operator">=</span> <span class="token function-calls function">find_objects_within_distance</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> neighborhood_cache<span class="token punctuation">,</span> COMBINATION_DISTANCE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>nearby_objects<span class="token punctuation">.</span>count <span class="token punctuation">&gt;</span> <span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Mark for combination</span>
        <span class="token comment">// TODO: Implement scatter-gather algorithm</span>
        <span class="token comment">// - Assign combination group ID</span>
        <span class="token comment">// - Calculate combined properties (mass-averaged velocity, centroid position)</span>
        <span class="token comment">// - Apply reaction rules for type transformation</span>
        <span class="token comment">// - Write combined object, mark merged objects for deletion</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="Combination Process" dir="auto" class="heading" id="Combination_Process_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Combination Process</h3></div><div class="el-p"><p dir="auto"><strong>Distance Check</strong>: Calculate distance between object centers; trigger if &lt; d.</p></div><div class="el-p"><p dir="auto"><strong>Group Formation</strong>: All objects within d of combined center merge together.</p></div><div class="el-p"><p dir="auto"><strong>Property Calculation</strong>:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Velocity: Mass-weighted average of all merged objects</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Position: Mass-weighted centroid</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Type: Determined by reaction rules (see <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/physics/reactions.html" data-href="reactions" aria-label="reactions" data-tooltip-position="top" target="_self">Reaction System</a></span></span></span>)</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>Mass: Based on new type</li>
</ul></div><div class="el-p"><p dir="auto"><strong>Atomic Operations</strong>: Use atomics to prevent race conditions when multiple groups overlap.</p></div><div class="el-h2"><h2 data-heading="Final Pass: Set Grid Position" dir="auto" class="heading" id="Final_Pass_Set_Grid_Position_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Final Pass: Set Grid Position</h2></div><div class="el-h3"><h3 data-heading="Overview" dir="auto" class="heading" id="Overview_2"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Overview</h3></div><div class="el-p"><p dir="auto"><strong>Purpose</strong>: Update which hex cell each object occupies based on its final sub-grid offset.</p></div><div class="el-p"><p dir="auto"><strong>Boundary Wrapping</strong>: Handle objects that have moved across world edges.</p></div><div class="el-p"><p dir="auto"><strong>Spatial Indexing</strong>: Ensure objects are correctly indexed for next frame's neighbor queries.</p></div><div class="el-h3"><h3 data-heading="Shader Structure" dir="auto" class="heading" id="Shader_Structure_2"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Shader Structure</h3></div><div class="el-pre"><pre class="language-wgsl"><code data-line="0" class="language-wgsl is-loaded"><span class="token punctuation">@</span><span class="token attributes attr-name">compute</span> <span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">8</span><span class="token punctuation">,</span> <span class="token int-literal number">8</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">set_grid_position</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span> global_id<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> hex_coord <span class="token operator">=</span> <span class="token function-calls function">calculate_hex_coord</span><span class="token punctuation">(</span>global_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> object <span class="token operator">=</span> <span class="token function-calls function">read_object</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>object<span class="token punctuation">.</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Calculate new hex cell based on offset</span>
    <span class="token keyword">let</span> new_hex_coord <span class="token operator">=</span> <span class="token function-calls function">calculate_hex_from_offset</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">,</span> object<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Normalize offset relative to new cell center</span>
    <span class="token keyword">let</span> normalized_offset <span class="token operator">=</span> <span class="token function-calls function">normalize_offset_to_cell</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>offset<span class="token punctuation">,</span> new_hex_coord<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Handle world wrapping</span>
    <span class="token keyword">let</span> wrapped_coord <span class="token operator">=</span> <span class="token function-calls function">wrap_hex_coordinate</span><span class="token punctuation">(</span>new_hex_coord<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapped_coord <span class="token operator">!=</span> hex_coord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Object moved to new cell - relocate it</span>
        object<span class="token punctuation">.</span>offset <span class="token operator">=</span> normalized_offset<span class="token punctuation">;</span>
        <span class="token function-calls function">atomic_write_object</span><span class="token punctuation">(</span>wrapped_coord<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function-calls function">delete_object</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Object stayed in same cell - just update offset</span>
        object<span class="token punctuation">.</span>offset <span class="token operator">=</span> normalized_offset<span class="token punctuation">;</span>
        <span class="token function-calls function">write_object</span><span class="token punctuation">(</span>hex_coord<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="Hexagonal Grid Algorithms" dir="auto" class="heading" id="Hexagonal_Grid_Algorithms_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Hexagonal Grid Algorithms</h2></div><div class="el-h3"><h3 data-heading="Polar/Cube Coordinates" dir="auto" class="heading" id="Polar/Cube_Coordinates_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Polar/Cube Coordinates</h3></div><div class="el-p"><p dir="auto"><strong>Coordinate System</strong>: Use cube coordinates (q, r, s) where q + r + s = 0.</p></div><div class="el-p"><p dir="auto"><strong>Neighbor Lookup</strong>: Efficient neighbor calculation using coordinate offsets.</p></div><div class="el-p"><p dir="auto"><strong>Point-to-Hex</strong>: Convert Cartesian (x, y) position to hex coordinates using cube algorithm.</p></div><div class="el-h3"><h3 data-heading="Skewed Parallelogram Storage" dir="auto" class="heading" id="Skewed_Parallelogram_Storage_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Skewed Parallelogram Storage</h3></div><div class="el-p"><p dir="auto"><strong>GPU Layout</strong>: Grid stored as skewed parallelogram in texture memory.</p></div><div class="el-p"><p dir="auto"><strong>Rectangular Indexing</strong>: Standard 2D texture coordinates map to hex cells.</p></div><div class="el-p"><p dir="auto"><strong>Wrapped Boundaries</strong>: World edges wrap seamlessly for continuous circular world.</p></div><div class="el-h3"><h3 data-heading="Two-Layer Neighborhood" dir="auto" class="heading" id="Two-Layer_Neighborhood_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Two-Layer Neighborhood</h3></div><div class="el-p"><p dir="auto"><strong>Layer Definition</strong>: Objects check 19 hex cells (center + 6 immediate + 12 second-layer).</p></div><div class="el-p"><p dir="auto"><strong>Shared Memory Size</strong>: 19 objects fit efficiently in workgroup shared memory.</p></div><div class="el-p"><p dir="auto"><strong>Coordinate Calculation</strong>: Precompute neighbor offsets for each hex layer.</p></div><div class="el-h2"><h2 data-heading="Workgroup Architecture" dir="auto" class="heading" id="Workgroup_Architecture_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Workgroup Architecture</h2></div><div class="el-h3"><h3 data-heading="Shared Memory Caching" dir="auto" class="heading" id="Shared_Memory_Caching_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Shared Memory Caching</h3></div><div class="el-p"><p dir="auto"><strong>Purpose</strong>: Load neighborhood data once per workgroup to minimize texture reads.</p></div><div class="el-p"><p dir="auto"><strong>Cache Size</strong>: 19 hex cells × object data size (position, velocity, type, mass).</p></div><div class="el-p"><p dir="auto"><strong>Synchronization</strong>: Workgroup barriers ensure all threads see cached data.</p></div><div class="el-pre"><pre class="language-wgsl"><code data-line="0" class="language-wgsl is-loaded"><span class="token comment">// Workgroup shared memory for hex neighborhood</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">workgroup</span><span class="token punctuation">&gt;</span> neighborhood_cache<span class="token punctuation">:</span> <span class="token builtin">array</span><span class="token punctuation">&lt;</span><span class="token class-name">ObjectData</span><span class="token punctuation">,</span> <span class="token int-literal number">19</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">workgroup</span><span class="token punctuation">&gt;</span> cache_loaded<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token functions function">load_hex_neighborhood_to_cache</span><span class="token punctuation">(</span>
    center_hex<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    local_id<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// First thread loads all 19 neighbors</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>local_id<span class="token punctuation">.</span>x <span class="token operator">==</span> <span class="token int-literal number">0</span> <span class="token operator">&amp;&amp;</span> local_id<span class="token punctuation">.</span>y <span class="token operator">==</span> <span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token int-literal number">0</span><span class="token punctuation">;</span> i <span class="token punctuation">&lt;</span> <span class="token int-literal number">19</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> neighbor_hex <span class="token operator">=</span> center_hex <span class="token operator">+</span> HEX_NEIGHBOR_OFFSETS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            neighborhood_cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function-calls function">read_object</span><span class="token punctuation">(</span>neighbor_hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cache_loaded <span class="token operator">=</span> <span class="token bool-literal boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="Workgroup Size" dir="auto" class="heading" id="Workgroup_Size_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Workgroup Size</h3></div><div class="el-p"><p dir="auto"><strong>Current Choice</strong>: 8×8 workgroups (64 threads).</p></div><div class="el-p"><p dir="auto"><strong>Rationale</strong>: Balance between GPU occupancy and shared memory usage.</p></div><div class="el-p"><p dir="auto"><strong>⚠️ NEEDS TUNING</strong>: Optimal workgroup size TBD through GPU profiling.</p></div><div class="el-h2"><h2 data-heading="Data Structures" dir="auto" class="heading" id="Data_Structures_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Data Structures</h2></div><div class="el-h3"><h3 data-heading="Object Physics Data" dir="auto" class="heading" id="Object_Physics_Data_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Object Physics Data</h3></div><div class="el-p"><p dir="auto"><strong>GPU Texture Layout</strong>:</p></div><div class="el-pre"><pre class="language-wgsl"><code data-line="0" class="language-wgsl is-loaded"><span class="token keyword">struct</span> <span class="token class-name">ObjectData</span> <span class="token punctuation">{</span>
    <span class="token comment">// Position (12 bytes)</span>
    hex_coord<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>      <span class="token comment">// 8 bytes - hex cell coordinates</span>
    offset<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>         <span class="token comment">// 8 bytes - fixed-point offset from cell center</span>

    <span class="token comment">// Velocity (8 bytes)</span>
    velocity<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>       <span class="token comment">// 8 bytes - fixed-point velocity vector</span>

    <span class="token comment">// Properties (8 bytes)</span>
    type_id<span class="token punctuation">:</span> <span class="token builtin">u32</span><span class="token punctuation">,</span>              <span class="token comment">// 4 bytes - object type</span>
    mass<span class="token punctuation">:</span> <span class="token builtin">u32</span><span class="token punctuation">,</span>                 <span class="token comment">// 4 bytes - mass (or could be computed from type)</span>

    <span class="token comment">// Flags (4 bytes)</span>
    layer<span class="token punctuation">:</span> <span class="token builtin">u32</span><span class="token punctuation">,</span>                <span class="token comment">// 4 bytes - Ground/Object/Air (could be packed)</span>
    exists<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token punctuation">,</span>              <span class="token comment">// 1 byte - object exists flag</span>
    <span class="token comment">// ... potential padding or additional flags</span>
<span class="token punctuation">}</span>
<span class="token comment">// Total: ~32 bytes per object (may be optimized with bit-packing)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><strong>Memory Packing</strong>: Consider bit-packing to reduce texture memory and bandwidth.</p></div><div class="el-h3"><h3 data-heading="Spell Buffer" dir="auto" class="heading" id="Spell_Buffer_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Spell Buffer</h3></div><div class="el-p"><p dir="auto"><strong>Structure</strong>: Array of active spell shapes in GPU buffer.</p></div><div class="el-p"><p dir="auto"><strong>Data Per Spell</strong>:</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Shape geometry (circle, rectangle, etc.)</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Position and radius</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>Element type(s)</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>Cast time (for element combination ordering)</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>Force magnitude/velocity value</li>
</ul></div><div class="el-p"><p dir="auto"><strong>Spatial Partitioning</strong>: Future optimization to limit spell checks per object.</p></div><div class="el-h2"><h2 data-heading="Fixed-Point Arithmetic" dir="auto" class="heading" id="Fixed-Point_Arithmetic_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Fixed-Point Arithmetic</h2></div><div class="el-h3"><h3 data-heading="Determinism Guarantee" dir="auto" class="heading" id="Determinism_Guarantee_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Determinism Guarantee</h3></div><div class="el-p"><p dir="auto"><strong>Integer-Only Operations</strong>: All physics calculations use fixed-point (scaled integers).</p></div><div class="el-p"><p dir="auto"><strong>Platform Independence</strong>: Avoids floating-point precision differences across GPUs.</p></div><div class="el-p"><p dir="auto"><strong>Bit Precision</strong>: Balance accuracy vs overflow risk (e.g., 16.16 fixed-point).</p></div><div class="el-p"><p dir="auto"><strong>Details</strong>: See <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/physics/determinism.html" data-href="determinism" aria-label="determinism" data-tooltip-position="top" target="_self">Determinism</a></span></span></span> for implementation.</p></div><div class="el-h3"><h3 data-heading="Example Operations" dir="auto" class="heading" id="Example_Operations_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Example Operations</h3></div><div class="el-pre"><pre class="language-wgsl"><code data-line="0" class="language-wgsl is-loaded"><span class="token comment">// Fixed-point addition (trivial)</span>
<span class="token keyword">fn</span> <span class="token functions function">fixed_point_add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fixed-point multiplication (scale factor = 2^16)</span>
<span class="token keyword">fn</span> <span class="token functions function">fixed_point_multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">i32</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">i32</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">i64</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">i64</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token int-literal number">16</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fixed-point division</span>
<span class="token keyword">fn</span> <span class="token functions function">fixed_point_divide</span><span class="token punctuation">(</span>numerator<span class="token punctuation">:</span> <span class="token builtin">i32</span><span class="token punctuation">,</span> denominator<span class="token punctuation">:</span> <span class="token builtin">i32</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">i64</span><span class="token punctuation">(</span>numerator<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token int-literal number">16</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">i64</span><span class="token punctuation">(</span>denominator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="Performance Optimizations" dir="auto" class="heading" id="Performance_Optimizations_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Performance Optimizations</h2></div><div class="el-h3"><h3 data-heading="Early Termination" dir="auto" class="heading" id="Early_Termination_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Early Termination</h3></div><div class="el-p"><p dir="auto"><strong>Stationary Objects</strong>: Skip force calculations for objects with zero velocity and no nearby activity.</p></div><div class="el-p"><p dir="auto"><strong>Convergence Detection</strong>: In overlap passes, terminate early if no combinations triggered.</p></div><div class="el-p"><p dir="auto"><strong>Pass Skipping</strong>: Skip remaining overlap passes once no objects need merging.</p></div><div class="el-h3"><h3 data-heading="Memory Bandwidth" dir="auto" class="heading" id="Memory_Bandwidth_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Memory Bandwidth</h3></div><div class="el-p"><p dir="auto"><strong>Coalesced Access</strong>: Threads in workgroup access contiguous memory locations.</p></div><div class="el-p"><p dir="auto"><strong>Texture Cache</strong>: Structure data layout for optimal GPU cache utilization.</p></div><div class="el-p"><p dir="auto"><strong>Bit-Packing</strong>: Compress object data to minimize texture memory bandwidth.</p></div><div class="el-h3"><h3 data-heading="Atomic Operations" dir="auto" class="heading" id="Atomic_Operations_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Atomic Operations</h3></div><div class="el-p"><p dir="auto"><strong>Combination Conflicts</strong>: Use atomic operations when multiple objects try to merge.</p></div><div class="el-p"><p dir="auto"><strong>Cell Relocation</strong>: Atomic writes when moving objects to new hex cells.</p></div><div class="el-p"><p dir="auto"><strong>Flag Updates</strong>: Atomic flags for convergence detection across workgroups.</p></div><div class="el-h2"><h2 data-heading="Integration Points" dir="auto" class="heading" id="Integration_Points_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Integration Points</h2></div><div class="el-h3"><h3 data-heading="Movement System" dir="auto" class="heading" id="Movement_System_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Movement System</h3></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Pipeline implements movement, velocity, and combination mechanics</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>See <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/physics/movement-system.html" data-href="movement-system" aria-label="movement-system" data-tooltip-position="top" target="_self">Movement System</a></span></span></span> for conceptual details</li>
</ul></div><div class="el-h3"><h3 data-heading="Forces" dir="auto" class="heading" id="Forces_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Forces</h3></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Force calculation details and formulas</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>See <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/physics/forces.html" data-href="forces" aria-label="forces" data-tooltip-position="top" target="_self">Forces</a></span></span></span> for force types and equations</li>
</ul></div><div class="el-h3"><h3 data-heading="Spell System" dir="auto" class="heading" id="Spell_System_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Spell System</h3></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Spell buffer provides force input</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>Objects check for overlapping spell shapes</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>See <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/spells/spells.html" data-href="spells" aria-label="spells" data-tooltip-position="top" target="_self">Spell System</a></span></span></span> for spell mechanics</li>
</ul></div><div class="el-h3"><h3 data-heading="Reaction System" dir="auto" class="heading" id="Reaction_System_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Reaction System</h3></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>Combination type transformations use reaction rules</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>See <span class="dataview inline-field"><span class="dataview inline-field-key" data-dv-key="cross-reference" data-dv-norm-key="cross-reference">cross-reference</span><span class="dataview inline-field-value" id="dataview-inline-field-0"><span><a rel="noopener nofollow" class="internal-link" href="architecture/systems/physics/reactions.html" data-href="reactions" aria-label="reactions" data-tooltip-position="top" target="_self">Reaction System</a></span></span></span> for transformation rules</li>
</ul></div><div class="el-h2"><h2 data-heading="Shader Development" dir="auto" class="heading" id="Shader_Development_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Shader Development</h2></div><div class="el-h3"><h3 data-heading="WGSL Implementation" dir="auto" class="heading" id="WGSL_Implementation_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>WGSL Implementation</h3></div><div class="el-p"><p dir="auto"><strong>Language</strong>: WebGPU Shading Language (WGSL).</p></div><div class="el-p"><p dir="auto"><strong>Compilation</strong>: Shaders compiled at runtime by WebGPU driver.</p></div><div class="el-p"><p dir="auto"><strong>Validation</strong>: Browser provides shader compilation errors during development.</p></div><div class="el-h3"><h3 data-heading="Hot Reloading" dir="auto" class="heading" id="Hot_Reloading_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Hot Reloading</h3></div><div class="el-p"><p dir="auto"><strong>Development Mode</strong>: Support shader hot-reloading for rapid iteration.</p></div><div class="el-p"><p dir="auto"><strong>Error Handling</strong>: Graceful fallback when shader compilation fails.</p></div><div class="el-p"><p dir="auto"><strong>Debugging</strong>: Use browser GPU debugging tools for shader profiling.</p></div><div class="el-h3"><h3 data-heading="Performance Profiling" dir="auto" class="heading" id="Performance_Profiling_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Performance Profiling</h3></div><div class="el-p"><p dir="auto"><strong>GPU Timers</strong>: Measure individual pass execution times.</p></div><div class="el-p"><p dir="auto"><strong>Bandwidth Monitoring</strong>: Track texture read/write operations.</p></div><div class="el-p"><p dir="auto"><strong>Workgroup Tuning</strong>: Profile different workgroup sizes for optimal performance.</p></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div class="graph-view-wrapper"><div class="feature-header"><div class="feature-title">Interactive Graph</div></div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<div class="graph-icon graph-global" role="button" aria-label="Global Graph" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#gpu-shaders_0" data-path="#gpu-shaders_0"><div class="tree-item-inner heading-link" heading-name="gpu-shaders">gpu-shaders</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#GPU_Shader_Architecture_0" data-path="#GPU_Shader_Architecture_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="GPU Shader Architecture">GPU Shader Architecture</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Pipeline_Overview_0" data-path="#Pipeline_Overview_0"><div class="tree-item-inner heading-link" heading-name="Pipeline Overview">Pipeline Overview</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Pass_1_Apply_Forces_+_Move_0" data-path="#Pass_1_Apply_Forces_+_Move_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Pass 1: Apply Forces + Move">Pass 1: Apply Forces + Move</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Overview_0" data-path="#Overview_0"><div class="tree-item-inner heading-link" heading-name="Overview">Overview</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Shader_Structure_0" data-path="#Shader_Structure_0"><div class="tree-item-inner heading-link" heading-name="Shader Structure">Shader Structure</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Force_Calculations_0" data-path="#Force_Calculations_0"><div class="tree-item-inner heading-link" heading-name="Force Calculations">Force Calculations</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Pass_2-N_Overlap_Passes_0" data-path="#Pass_2-N_Overlap_Passes_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Pass 2-N: Overlap Passes">Pass 2-N: Overlap Passes</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Overview_1" data-path="#Overview_1"><div class="tree-item-inner heading-link" heading-name="Overview">Overview</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Shader_Structure_1" data-path="#Shader_Structure_1"><div class="tree-item-inner heading-link" heading-name="Shader Structure">Shader Structure</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Combination_Process_0" data-path="#Combination_Process_0"><div class="tree-item-inner heading-link" heading-name="Combination Process">Combination Process</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Final_Pass_Set_Grid_Position_0" data-path="#Final_Pass_Set_Grid_Position_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Final Pass: Set Grid Position">Final Pass: Set Grid Position</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Overview_2" data-path="#Overview_2"><div class="tree-item-inner heading-link" heading-name="Overview">Overview</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Shader_Structure_2" data-path="#Shader_Structure_2"><div class="tree-item-inner heading-link" heading-name="Shader Structure">Shader Structure</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Hexagonal_Grid_Algorithms_0" data-path="#Hexagonal_Grid_Algorithms_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Hexagonal Grid Algorithms">Hexagonal Grid Algorithms</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Polar/Cube_Coordinates_0" data-path="#Polar/Cube_Coordinates_0"><div class="tree-item-inner heading-link" heading-name="Polar/Cube Coordinates">Polar/Cube Coordinates</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Skewed_Parallelogram_Storage_0" data-path="#Skewed_Parallelogram_Storage_0"><div class="tree-item-inner heading-link" heading-name="Skewed Parallelogram Storage">Skewed Parallelogram Storage</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Two-Layer_Neighborhood_0" data-path="#Two-Layer_Neighborhood_0"><div class="tree-item-inner heading-link" heading-name="Two-Layer Neighborhood">Two-Layer Neighborhood</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Workgroup_Architecture_0" data-path="#Workgroup_Architecture_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Workgroup Architecture">Workgroup Architecture</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Shared_Memory_Caching_0" data-path="#Shared_Memory_Caching_0"><div class="tree-item-inner heading-link" heading-name="Shared Memory Caching">Shared Memory Caching</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Workgroup_Size_0" data-path="#Workgroup_Size_0"><div class="tree-item-inner heading-link" heading-name="Workgroup Size">Workgroup Size</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Data_Structures_0" data-path="#Data_Structures_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Data Structures">Data Structures</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Object_Physics_Data_0" data-path="#Object_Physics_Data_0"><div class="tree-item-inner heading-link" heading-name="Object Physics Data">Object Physics Data</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Spell_Buffer_0" data-path="#Spell_Buffer_0"><div class="tree-item-inner heading-link" heading-name="Spell Buffer">Spell Buffer</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Fixed-Point_Arithmetic_0" data-path="#Fixed-Point_Arithmetic_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Fixed-Point Arithmetic">Fixed-Point Arithmetic</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Determinism_Guarantee_0" data-path="#Determinism_Guarantee_0"><div class="tree-item-inner heading-link" heading-name="Determinism Guarantee">Determinism Guarantee</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Example_Operations_0" data-path="#Example_Operations_0"><div class="tree-item-inner heading-link" heading-name="Example Operations">Example Operations</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Performance_Optimizations_0" data-path="#Performance_Optimizations_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Performance Optimizations">Performance Optimizations</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Early_Termination_0" data-path="#Early_Termination_0"><div class="tree-item-inner heading-link" heading-name="Early Termination">Early Termination</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Memory_Bandwidth_0" data-path="#Memory_Bandwidth_0"><div class="tree-item-inner heading-link" heading-name="Memory Bandwidth">Memory Bandwidth</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Atomic_Operations_0" data-path="#Atomic_Operations_0"><div class="tree-item-inner heading-link" heading-name="Atomic Operations">Atomic Operations</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Integration_Points_0" data-path="#Integration_Points_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Integration Points">Integration Points</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Movement_System_0" data-path="#Movement_System_0"><div class="tree-item-inner heading-link" heading-name="Movement System">Movement System</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Forces_0" data-path="#Forces_0"><div class="tree-item-inner heading-link" heading-name="Forces">Forces</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Spell_System_0" data-path="#Spell_System_0"><div class="tree-item-inner heading-link" heading-name="Spell System">Spell System</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Reaction_System_0" data-path="#Reaction_System_0"><div class="tree-item-inner heading-link" heading-name="Reaction System">Reaction System</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="architecture/systems/physics/gpu-shaders.html#Shader_Development_0" data-path="#Shader_Development_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Shader Development">Shader Development</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#WGSL_Implementation_0" data-path="#WGSL_Implementation_0"><div class="tree-item-inner heading-link" heading-name="WGSL Implementation">WGSL Implementation</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Hot_Reloading_0" data-path="#Hot_Reloading_0"><div class="tree-item-inner heading-link" heading-name="Hot Reloading">Hot Reloading</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="architecture/systems/physics/gpu-shaders.html#Performance_Profiling_0" data-path="#Performance_Profiling_0"><div class="tree-item-inner heading-link" heading-name="Performance Profiling">Performance Profiling</div></a><div class="tree-item-children"></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>